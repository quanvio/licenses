<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>License Redirect</title>
  <meta name="robots" content="noindex" />
  <script>
    async function run() {
      const params = new URLSearchParams(location.search);
      let id = (params.get('id') || '').trim();

      // also support /license/<id>
      if (!id) {
        const parts = location.pathname.split('/').filter(Boolean);
        const ix = parts.indexOf('license');
        if (ix >= 0 && parts[ix + 1]) id = parts[ix + 1].trim();
      }

      // ✅ allow any length as long as it's present
      if (!id) {
        document.body.textContent = 'Invalid or missing ID.';
        return;
      }

      try {
        const resp = await fetch('../data/licenses.json', { cache: 'no-store' });
        if (!resp.ok) throw new Error('Failed to load license data');
        const data = await resp.json();

        const item = (data.items || []).find(x => x.LicenseId === id);

        if (item && item.Active === true && item.Link) {
          location.href = item.Link;
        } else {
          document.body.textContent = 'Not found or inactive.';
        }
      } catch (e) {
        document.body.textContent = 'Service unavailable.';
      }
    }
    addEventListener('DOMContentLoaded', run);
  </script>
</head>
<body>Checking license…</body>
</html>
